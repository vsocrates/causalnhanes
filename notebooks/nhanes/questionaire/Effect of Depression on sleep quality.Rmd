---
title: "Effect of Depression on Sleep"
output: html_notebook
---
Introdution

documentation about depression questionaire: https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/
documentation about sleep problems:  https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/SLQ_I.htm#SLQ120

We will use the data from the depression questionaire and sleep problem questionaire to try and determine a causal relationship between depression and sleep problems

Depression questionaire
To clean our data, we removed individuals who had missing answers, refused, or didn't know for any of the questions except DPQ100, since DPQ100 doesn't contribute to the depression score in the PHQ-9.^1 We then sum the values of the answers to get an individuals depression score, stored in data frame depScore.

Sleep problems
Since the required amount of sleep can vary grealy from person to person, we decided to characterize poor sleep by peoples answers to SLQ120: "How often feel overly sleepy during day?". We cleaned the data by eliminating missing, refused and don't know answers, then We characterized people who had 5 or more days of being overly sleepy as having sleep problems.

We assume random treatment assignment, so the observed risks equal the counterfactual risks.

```{r}
library(dplyr)
# reading data files
cleanD = read.csv(file = "CleanD.csv")
cleanSleep = read.csv(file = "cleanSleep.csv")
depScore = cleanD[2]
depScore[2] = cleanD[3]
# summing depression score
for(i in 4:11) {depScore[2] = depScore[2] + cleanD[i]}

#merging of sleep and depression datasets for analysis
goodSleep = merge(cleanSleep, depScore, type = "inner")
badSleep = merge(cleanSleep, depScore, type = "inner")

#poor sleepers
badSleep = badSleep %>% filter(SLQ120 > 2)

#good sleepers
depRest = goodSleep %>% filter(SLQ120 <3)
```
Now that we have separate data frames for people with good and bad sleep, we should look at histograms of the depression data for some exploratory data analysis.

```{r}
plot(count(badSleep, DPQ010), xlab = "DPQ010 score", ylab = "frequency", main ="Bad Sleeper Histogram")
```

```{r}
plot(count(goodSleep,DPQ010), xlab = "DPQ010 score", ylab = "frequency", main = "Good Sleeper Histogram")
```
Comparing the two graphs, we see an interesting feature where they both seem to follow an exponential decay curve, but the histogram for the poor sleepers is much more erratic. Further data analysis is necessary, so we find the causal risk difference.

```{r}
#filter by depression score
depSleepy = badSleep %>% filter(DPQ010 > 9)
hapSleepy = badSleep %>% filter(DPQ010 < 10)
depRest = goodSleep %>% filter(DPQ010 > 9)
hapRest = goodSleep %>% filter(DPQ010 < 10)

crd = nrow(depSleepy)/(nrow(depSleepy) + nrow(depRest)) - nrow(hapSleepy)/(nrow(hapSleepy) + nrow(hapRest))
```
And we find a causal risk difference of .1281208

1: http://www.lphi.org/LPHIadmin/uploads/.PHQ-9-Review-Kroenke-63754.PDF